<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Status Codes Dashboard</title>
    <script type="text/javascript" src="../highcharts/js/jquery.min.js"></script>
    <script type="text/javascript" src="../highcharts/js/highcharts.js"></script>

    <script type="text/javascript">
    
        <!--------------------->
        <!-- REAL TIME CHART -->
        <!--------------------->
        var realTimeSCChart;
        var realTimeSCStartTime;
        $(document).ready(function () {

            <!-- Load start time of data -->
            $.ajax({
                url: '/data-visualizer/rest/status_codes/all',
                dataType: 'json',
                success: function (data) {
                    realTimeSCStartTime = data[0].time;
                },
                cache: false,
                async: false
            });


            realTimeSCChart = new Highcharts.Chart({
                chart: {
                    renderTo: 'realTimeSC',
                    type: 'spline',
                    animation: Highcharts.svg,
                    marginRight: 10,
                    events: {
                        load: function () {

                            var series200 = this.series[0];
                            var series500 = this.series[1];
                            var series304 = this.series[2];
                            var series503 = this.series[3];
                            
                            setInterval(function () {
                                $.ajax({
                                    url: '/data-visualizer/rest/status_codes/non_read',
                                    type: 'GET',
                                    async: true,
                                    dataType: "json",
                                    success: function (data) {
                                        for (var i in data) {
                                            series200.addPoint([data[i].time, data[i].statusCodes.status_200], false, true);
                                            series500.addPoint([data[i].time, data[i].statusCodes.status_500], false, true);
                                            series304.addPoint([data[i].time, data[i].statusCodes.status_304], false, true);
                                            series503.addPoint([data[i].time, data[i].statusCodes.status_503], true, true);
                                        }
                                    }

                                });


                            }, 1000);
                        }
                    }

                },

                title: {
                    text: 'Real time responses by code'
                },
                xAxis: {
                    type: 'datetime',
                    tickPixelInterval: 150
                },
                yAxis: {
                    min: 0,
                    title: {
                        text: ''
                    },
                    plotLines: [{
                        value: 0,
                        width: 1,
                        color: '#808080'
                    }]
                },
                tooltip: {
                    formatter: function () {
                        return '<b>' + this.series.name + '</b><br/>' +
                            Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.x) + '<br/>' +
                            Highcharts.numberFormat(this.y, 2);
                    }
                },
                legend: {
                    enabled: true
                },
                exporting: {
                    enabled: false
                },
                series: [{
                    name: '200',
                    data: (function () {
                        // generate an array of random data
                        var data = [],
                            time = (new Date()).getTime(),
                            i;

                        for (i = -19; i <= 0; i++) {
                            data.push({
                                x: time + i * 1000,
                                y: 0
                            });
                        }
                        return data;
                    })()
                }, {
                    name: '500',
                    data: (function () {
                        // generate an array of random data
                        var data = [],
                            time = (new Date()).getTime(),
                            i;

                        for (i = -19; i <= 0; i++) {
                            data.push({
                                x: time + i * 1000,
                                y: 0
                            });
                        }
                        return data;
                    })()
                }, {
                    name: '304',
                    data: (function () {
                        // generate an array of random data
                        var data = [],
                            time = (new Date()).getTime(),
                            i;

                        for (i = -19; i <= 0; i++) {
                            data.push({
                                x: time + i * 1000,
                                y: 0
                            });
                        }
                        return data;
                    })()
                }, {
                    name: '503',
                    data: (function () {
                        // generate an array of random data
                        var data = [],
                            time = (new Date()).getTime(),
                            i;

                        for (i = -19; i <= 0; i++) {
                            data.push({
                                x: time + i * 1000,
                                y: 0
                            });
                        }
                        return data;
                    })()
                }]
            });
        });


        <!--------------------->
        <!-- PIE DATA CHART  -->
        <!--------------------->
        var aggregateScChart;
        var aggregateScStartTime;
        $(document).ready(function () {

        	$.ajax({
                url: '/data-visualizer/rest/status_codes/all',
                dataType: 'json',
                success: function (data) {
                    aggregateScStartTime = data[0].time;
                },
                cache: false,
                async: false
            });

            aggregateScChart = new Highcharts.Chart({
                chart: {
                    renderTo: 'aggregateSC',
                    type: 'pie',
                    events: {
                        load: getAggregateData
                    }
                },
                title: {
                    text: 'Aggregate Results '
                },
                subtitle: {
                    text: 'since ' + new Date(aggregateScStartTime).toUTCString()
                },
                xAxis: {

                },
                yAxis: {
                    min: 0,
                    title: {
                        text: ''
                    }
                },
                legend: {
                    enabled: true
                },
                tooltip: {
                    headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
                    pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
                        '<td style="padding:0"><b>{point.y:.1f} </b></td></tr>',
                    footerFormat: '</table>',
                    shared: true,
                    useHTML: true
                },
                plotOptions: {
                    column: {
                        pointPadding: 0.2,
                        borderWidth: 0
                    }
                },
                series: [{
                    name: 'Browser share',
                    data: []

                }]
            });

        });
        
        function getAggregateData() {
           
            $.ajax({
                url: '/data-visualizer/rest/status_codes/aggregate',
                dataType: 'json',
                success: function (json) {
                    var data = [];
                    for (var i = 0; i < json.length; i++) {
                        var j = json[i];
                        for (var k in j) {
                            data.push({
                                name: k,
                                y: j[k]
                            });
                        }
                        aggregateScChart.series[0].setData(data);
                    }
                },
                cache: false
            });
        }


        <!--------------------->
        <!--  ALL TIME CHART -->
        <!--------------------->
        var chart;
        var startTime;
        $(document).ready(function () {

            $.ajax({
                url: '/data-visualizer/rest/status_codes/all',
                dataType: 'json',
                success: function (data) {
                    startTime = data[0].time;
                },
                cache: false,
                async: false
            });

            chart = new Highcharts.Chart({
                chart: {
                    renderTo: 'container',
                    zoomType: 'x',
                    events: {
                        load: getData
                    }
                },
                title: {
                    text: 'Status Codes per 2s '
                },
                subtitle: {
                    text: document.ontouchstart === undefined ?
                        'since ' + new Date(startTime).toUTCString() : ''
                },
                xAxis: {
                    type: 'datetime',
                    minRange: 2 * 1000 
                },
                yAxis: {
                    min: 0,
                    title: {
                        text: ''
                    }
                },
                legend: {
                    enabled: true
                },
                plotOptions: {
                    area: {
                        fillColor: {
                            linearGradient: {
                                x1: 0,
                                y1: 0,
                                x2: 0,
                                y2: 1
                            },
                            stops: [
                                [0, Highcharts.getOptions().colors[0]],
                                [1, Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0).get('rgba')]
                            ]
                        },
                        marker: {
                            radius: 2
                        },
                        lineWidth: 1,
                        states: {
                            hover: {
                                lineWidth: 1
                            }
                        },
                        threshold: null
                    }
                },

                series: [{
                    type: 'area',
                    name: '200',
                    pointInterval: 2 * 1000,
                    pointStart: startTime,
                    data: []
                }, {
                    type: 'area',
                    name: '500',
                    pointInterval: 2 * 1000,
                    pointStart: startTime,
                    data: []
                }, {
                    type: 'area',
                    name: '503',
                    pointInterval: 2 * 1000,
                    pointStart: startTime,
                    data: []
                }, {
                    type: 'area',
                    name: '304',
                    pointInterval: 2 * 1000,
                    pointStart: startTime,
                    data: []
                }]
            });
        });


        function getData() {
            $.ajax({
                url: '/data-visualizer/rest/status_codes/all',
                dataType: 'json',
                success: function (data) {
                    var categories = [];
                    var seriesData200 = [];
                    var seriesData500 = [];
                    var seriesData503 = [];
                    var seriesData304 = [];

                    $.each(data, function (i, e) {
                        categories.push(i);
                    	seriesData200.push(e.statusCodes.status_200);
                        seriesData500.push(e.statusCodes.status_500);
                        seriesData503.push(e.statusCodes.status_503);
                        seriesData304.push(e.statusCodes.status_304);
                    });

                    chart.series[0].setData(seriesData200);
                    chart.series[1].setData(seriesData500);
                    chart.series[2].setData(seriesData503);
                    chart.series[3].setData(seriesData304);
           
                },
                cache: false
            });
        }
    </script>

</head>

<body>
    <div id="realTimeSC" style="width: 60%; height: 400px; margin: 0 auto; margin-bottom:50px; float:left"></div>
    <div id="aggregateSC" style="width: 40%; height: 400px; margin: 0 auto; margin-bottom:50px; float:right"></div>
    <div id="container" style="width: 100%; height: 400px; margin: 0 auto"></div>
</body>

</html>